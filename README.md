## Legend Active Volume Analysis
This repository contains the scripts used to determine the Active Volume (AV) of the LEGEND ICPC germanium detectors. 
The analysis is divided up by radioactive source used for the characterisation - e.g. Ba-133, Am-241. Note that currently only the Ba-133 analysis has been completed. 

The data used in this analysis is the HADES characterisation data, which is stored at MPIK. We are using the <code>pygama</code> processed data.

The MC simulations used are generated by <code> legend-g4-simple-simulation </code>, which automatically generates raw MC spectra and AV postprocessing, according to a given config file. These are also stored at MPIK.

### Python Environment
If you do not already have your own python 3 environment set up at MPIK (with pygama, pandas etc installed), please run the following commands before using the analysis scripts:
<code> source /lfs/l1/legend/legend-prodenv/setup.sh </code>
<code> prodenv-load-sw /lfs/l1/legend/legend-prodenv/prod-usr/ggmarsh-test-v03/config.json </code>

### Analysis Flow
E.g. for Ba-133:

All scripts used can be managed through a master script "Ba133/Process_Detectors.py", which allows automatic and rapid processing of multiple detectors at once. However the following order for each detector must be followed. 

1) Calibrate data
2) Gamma line counting of calibrated data
3) Generate raw MC & perform AV post processing for range of FCCDs
4) Gamma line counting of each AV post processed MC
5) Compute best fit FCCD
6) AV postprocessing for best fit FCCD 
7) Gamma line counting for MC with best fit FCCD 
8) Plot comparison spectra of data with best fit FCCD
